<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Genie Press - Genie Press</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Genie Press | Build awesome (Laravelesque) WordPress Plugins and Themes</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Genie Press" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Build awesome (Laravelesque) WordPress Plugins and Themes" /> <meta property="og:description" content="Build awesome (Laravelesque) WordPress Plugins and Themes" /> <link rel="canonical" href="/" /> <meta property="og:url" content="/" /> <meta property="og:site_name" content="Genie Press" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Genie Press" /> <script type="application/ld+json"> {"@type":"WebSite","headline":"Genie Press","url":"/","description":"Build awesome (Laravelesque) WordPress Plugins and Themes","name":"Genie Press","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> Genie Press </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="/" class="nav-list-link active">Genie Press</a></li><li class="nav-list-item"><a href="/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/components/" class="nav-list-link">Components</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/Reference/" class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/Reference/hooks_and_filters/" class="nav-list-link">Hooks & Filters</a></li><li class="nav-list-item "><a href="/Reference/shortcodes/" class="nav-list-link">Shortcodes</a></li><li class="nav-list-item "><a href="/Reference/views/" class="nav-list-link">Views</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="genie-the-wordpress-programmers-toolkit"> <a href="#genie-the-wordpress-programmers-toolkit" class="anchor-heading" aria-labelledby="genie-the-wordpress-programmers-toolkit"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Genie: The WordPress Programmer’s Toolkit </h1> <p>I got tired of copying and pasting this code from plugin to plugin to theme</p> <p>Here it is… enjoy :)</p> <p>Sunil</p> <h2 id="add-genie-through-composer"> <a href="#add-genie-through-composer" class="anchor-heading" aria-labelledby="add-genie-through-composer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Add Genie through composer </h2> <p><code class="language-plaintext highlighter-rouge">composer require "lnk7\genie"</code></p> <h2 id="update-composerjson"> <a href="#update-composerjson" class="anchor-heading" aria-labelledby="update-composerjson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Update composer.json </h2> <p>In this example we’ll be using the namespace <code class="language-plaintext highlighter-rouge">GeniePluginExample</code>, so let’s update <code class="language-plaintext highlighter-rouge">composer.json</code> with the right location for the php files. In this example We’re storing php files in the <code class="language-plaintext highlighter-rouge">src/php</code> folder.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lnk7/test"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Testimonial Plugin using GeniePress"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GPL-2.0-or-later"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"require"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"lnk7/genie"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"minimum-stability"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stable"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"autoload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"psr-4"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"GeniePluginExample\\"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src/php"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="create-your-plugin-file"> <a href="#create-your-plugin-file" class="anchor-heading" aria-labelledby="create-your-plugin-file"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create your plugin file </h2> <p>Now let’s create our plugin file. We’ll call it <code class="language-plaintext highlighter-rouge">testimonials.php</code></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="cd">/**
 * Plugin Name:       Testimonials
 * Description:       Let's see how Genie performs
 * Version:           1.0.0
 */</span>

<span class="kn">namespace</span> <span class="nn">GeniePluginExample</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">GeniePluginExample\PostTypes\Testimonial</span>
<span class="p">;</span><span class="kn">use</span> <span class="nc">Lnk7\Genie\Genie</span><span class="p">;</span>

<span class="c1">// Include composer</span>
<span class="k">include_once</span><span class="p">(</span><span class="s1">'vendor/autoload.php'</span><span class="p">);</span>

<span class="c1">// Get Genie Going  - Fire in the Genie Components</span>
<span class="nc">Genie</span><span class="o">::</span><span class="nf">createPlugin</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">withComponents</span><span class="p">([</span>
            <span class="nc">Plugin</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
            <span class="nc">Testimonial</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="nf">start</span><span class="p">();</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Genie</code> has two main methods called <code class="language-plaintext highlighter-rouge">createPlugin()</code> and <code class="language-plaintext highlighter-rouge">createTheme()</code>.<br /> If you are creating a theme, all the steps in the tutorial are the same except the above code would be in your <code class="language-plaintext highlighter-rouge">functions.php</code> file.</p> <p>The above code tells Genie to load the <code class="language-plaintext highlighter-rouge">Plugin</code> class.</p> <p>I like encapsulating code in components</p> <h2 id="the-plugin-component"> <a href="#the-plugin-component" class="anchor-heading" aria-labelledby="the-plugin-component"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The <code class="language-plaintext highlighter-rouge">Plugin</code> component </h2> <p>Each Component implements the <code class="language-plaintext highlighter-rouge">GenieComponent</code> Interface - It must have a <code class="language-plaintext highlighter-rouge">setup()</code> method.</p> <p>In this example, the Plugin class will be responsible for ensuring jQuery is loaded in the front-end.</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">GeniePluginExample</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Lnk7\Genie\Interfaces\GenieComponent</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\HookInto</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Plugin</span> <span class="kd">implements</span> <span class="nc">GenieComponent</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">setup</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="cd">/**
         * Make sure we load jQuery
         */</span>
        <span class="nc">HookInto</span><span class="o">::</span><span class="nf">action</span><span class="p">(</span><span class="s1">'wp_enqueue_scripts'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nf">wp_enqueue_script</span><span class="p">(</span><span class="s1">'jQuery'</span><span class="p">);</span>
            <span class="p">});</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div> <p>Here we’re using Genie’s <code class="language-plaintext highlighter-rouge">HookInto</code> utility to hook into the <code class="language-plaintext highlighter-rouge">wp_enqueue_scripts</code> to ensure jQuery is loaded. <code class="language-plaintext highlighter-rouge">HookInto</code> uses reflection to work out the parameters required to be sent into the function (here there are none).</p> <p>The <code class="language-plaintext highlighter-rouge">setup()</code> method is the place to add all hooks, register schemas and APIs</p> <h2 id="custom-posts-and-acf"> <a href="#custom-posts-and-acf" class="anchor-heading" aria-labelledby="custom-posts-and-acf"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Custom Posts and ACF </h2> <p>So let’s have a look at the testimonial component</p> <p>Genie provides a handy utility to register CustomPosts. Your Class should extend <code class="language-plaintext highlighter-rouge">CustomPost</code></p> <p>Here is a sample custom Post type called Testimonial</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">GeniePluginExample\PostTypes</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Lnk7\Genie\Abstracts\CustomPost</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Fields\SelectField</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Fields\TextField</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\AddShortcode</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\CreateCustomPostType</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\CreateSchema</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\RegisterAjax</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\RegisterApi</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\Utilities\Where</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Lnk7\Genie\View</span><span class="p">;</span>

<span class="cd">/**
 * Class Testimonial
 *
 * @package GeniePlugin\PostTypes
 * 
 * I'm adding these here my IDE knows these exist 
 * @property string $name
 * @property string $location
 */</span>
<span class="kd">class</span> <span class="nc">Testimonial</span> <span class="kd">extends</span> <span class="nc">CustomPost</span>
<span class="p">{</span>

    <span class="c1">// This is the post type</span>
    <span class="k">static</span> <span class="nv">$postType</span> <span class="o">=</span> <span class="s1">'testimonial'</span><span class="p">;</span>


    <span class="c1">// We're going to use this later in the ACF Schema Definition, and in </span>
    <span class="c1">// our ajax validation callback</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="nv">$locations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'gb'</span> <span class="o">=&gt;</span> <span class="s1">'London'</span><span class="p">,</span>
        <span class="s1">'fr'</span> <span class="o">=&gt;</span> <span class="s1">'France'</span><span class="p">,</span>
    <span class="p">];</span>


    <span class="c1">// This is called by Genie  </span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">setup</span><span class="p">()</span>
    <span class="p">{</span>
    
        <span class="c1">// We should call the parent setup();</span>
        <span class="k">parent</span><span class="o">::</span><span class="nf">setup</span><span class="p">();</span>

        <span class="c1">// Use a Genie to register the custom post. Most classes</span>
        <span class="c1">// in genie are fluent.  I just find it reads better</span>
        <span class="nc">CreateCustomPostType</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$postType</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">icon</span><span class="p">(</span><span class="s1">'dashicons-admin-comments'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">register</span><span class="p">();</span>


        <span class="c1">// Create an ACF Schema ! </span>
        <span class="nc">CreateSchema</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'Testimonial'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">withFields</span><span class="p">([</span>
                <span class="c1">// We have a whole bunch of fields we can use - Check teh </span>
                <span class="c1">// Fields folder</span>
                <span class="nc">TextField</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">required</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">wrapperWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
                <span class="nc">SelectField</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'location'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">choices</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$locations</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="k">default</span><span class="p">(</span><span class="s1">'london'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">returnFormat</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">required</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">wrapperWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>

            <span class="p">])</span>
            <span class="c1">// Where should this be shown?</span>
            <span class="o">-&gt;</span><span class="nf">shown</span><span class="p">(</span><span class="nc">Where</span><span class="o">::</span><span class="nf">field</span><span class="p">(</span><span class="s1">'post_type'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">equals</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$postType</span><span class="p">))</span>
            <span class="c1">//Attach it to this class so we can do fancy stuff - see later</span>
            <span class="o">-&gt;</span><span class="nf">attachTo</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">register</span><span class="p">();</span>

        <span class="c1">// Use genie to register an ajax endpoint</span>
        <span class="nc">RegisterAjax</span><span class="o">::</span><span class="nf">url</span><span class="p">(</span><span class="s1">'testimonial/create'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">([</span><span class="k">static</span><span class="o">::</span><span class="n">class</span><span class="p">,</span> <span class="s1">'addTestimonial'</span><span class="p">]);</span>

        <span class="c1">// Register an api endpoint to return all the Testimonials</span>
        <span class="nc">RegisterApi</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'testimonials'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nf">get</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">toArray</span><span class="p">();</span>
            <span class="p">});</span>


        <span class="c1">// Let's setup the testimonial form </span>
        <span class="nc">AddShortcode</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'testimonial_form'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="c1">// nice , we're using twig !   All your </span>
                <span class="k">return</span> <span class="nc">View</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'testimonials/form.twig'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">addVar</span><span class="p">(</span><span class="s1">'locations'</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="nv">$locations</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">render</span><span class="p">();</span>
            <span class="p">});</span>

        <span class="c1">// Show one Testimonial</span>
        <span class="nc">AddShortcode</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'testimonial'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$attributes</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$attributes</span> <span class="o">=</span> <span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="nf">shortcode_atts</span><span class="p">([</span>
                    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">],</span> <span class="nv">$attributes</span><span class="p">);</span>

                <span class="nv">$testimonial</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="nf">get</span><span class="p">([</span>
                    <span class="s1">'meta_key'</span>   <span class="o">=&gt;</span> <span class="s1">'name'</span><span class="p">,</span>
                    <span class="s1">'meta_value'</span> <span class="o">=&gt;</span> <span class="nv">$attributes</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
                <span class="p">])</span><span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>

                <span class="k">return</span> <span class="nc">View</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'testimonials/testimonial.twig'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">addVar</span><span class="p">(</span><span class="s1">'testimonial'</span><span class="p">,</span> <span class="nv">$testimonial</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">addVar</span><span class="p">(</span><span class="s1">'locations'</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="nv">$locations</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">render</span><span class="p">();</span>
            <span class="p">});</span>


        <span class="c1">// Show all testimonials</span>
        <span class="nc">AddShortcode</span><span class="o">::</span><span class="nf">called</span><span class="p">(</span><span class="s1">'testimonials'</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="nf">run</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$attributes</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$testimonials</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="nf">get</span><span class="p">();</span>

                <span class="k">return</span> <span class="nc">View</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'testimonials/testimonials.twig'</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">addVar</span><span class="p">(</span><span class="s1">'testimonials'</span><span class="p">,</span> <span class="nv">$testimonials</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">addVar</span><span class="p">(</span><span class="s1">'locations'</span><span class="p">,</span> <span class="k">static</span><span class="o">::</span><span class="nv">$locations</span><span class="p">)</span>
                    <span class="o">-&gt;</span><span class="nf">render</span><span class="p">();</span>
            <span class="p">});</span>
    <span class="p">}</span>


    <span class="cd">/**
     * Add a testimonial - called from Ajax
     *
     * @param $title
     * @param $text
     * @param $name
     * @param $location
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">addTestimonial</span><span class="p">(</span><span class="nv">$title</span><span class="p">,</span> <span class="nv">$text</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$location</span><span class="p">)</span>
    <span class="p">{</span>
    
        <span class="c1">// There's not much we need to do here, Genie has already made sure </span>
        <span class="c1">// that each of the parameters being sent by the ajax call have been </span>
        <span class="c1">// set.</span>
    
    
        <span class="c1">// let's create the testimonial.</span>
        <span class="nv">$testimonial</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'post_title'</span>   <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span>
            <span class="s1">'post_content'</span> <span class="o">=&gt;</span> <span class="nv">$text</span><span class="p">,</span>
            <span class="s1">'name'</span>         <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span>
            <span class="s1">'location'</span>     <span class="o">=&gt;</span> <span class="nv">$location</span><span class="p">,</span>
            <span class="s1">'post_status'</span>  <span class="o">=&gt;</span> <span class="s1">'draft'</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// Genie will convert this back to json for us</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Testimonial pending approval'</span><span class="p">,</span>
            <span class="s1">'id'</span>      <span class="o">=&gt;</span> <span class="nv">$testimonial</span><span class="o">-&gt;</span><span class="no">ID</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div> <h2 id="lets-have-a-look-at-the-twig-files"> <a href="#lets-have-a-look-at-the-twig-files" class="anchor-heading" aria-labelledby="lets-have-a-look-at-the-twig-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Let’s have a look at the twig files </h2> <p>By default Genie looks in the ‘src/twig’ folder for your twig files</p> <h3 id="formtwig"> <a href="#formtwig" class="anchor-heading" aria-labelledby="formtwig"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Form.twig </h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"testimonialForm"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;&lt;label</span> <span class="na">for=</span><span class="s">"title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"title"</span> <span class="na">required</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;label</span> <span class="na">for=</span><span class="s">"testimonial"</span><span class="nt">&gt;</span>Testimonial<span class="nt">&lt;/label&gt;&lt;textarea</span>
            <span class="na">id=</span><span class="s">"testimonial"</span><span class="nt">&gt;&lt;/textarea&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;label</span> <span class="na">for=</span><span class="s">"name"</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"name"</span> <span class="na">required</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;label</span> <span class="na">for=</span><span class="s">"location"</span><span class="nt">&gt;</span>Location<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"location"</span> <span class="na">required</span><span class="nt">&gt;</span>
            {% for code,text in locations %}
            <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"{{ code }}"</span><span class="nt">&gt;</span>{{ text }}<span class="nt">&lt;/option&gt;</span>
            {% endfor %}
        <span class="nt">&lt;/select&gt;</span>
    <span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">id=</span><span class="s">"submitButton"</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;p&gt;&lt;span</span> <span class="na">id=</span><span class="s">"message"</span><span class="nt">&gt;&lt;/span&gt;&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;script&gt;</span>

    <span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">buttonClicked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#testimonialForm</span><span class="dl">'</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">buttonClicked</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">buttonClicked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>

                <span class="c1">// Checkout the sneaky ajax_url twig function that grabs the </span>
                <span class="c1">// right url and add the needed nonce.  </span>
                <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">{{ ajax_url(</span><span class="dl">'</span><span class="nx">testimonial</span> <span class="o">/</span> <span class="nx">create</span>
            <span class="dl">'</span><span class="s1">) }}</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">data</span>
        <span class="p">:</span>
            <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
                <span class="na">title</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#title</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">text</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#testimonial</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">name</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#name</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="na">location</span><span class="p">:</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#location</span><span class="dl">'</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="dl">"</span><span class="s2">:selected</span><span class="dl">"</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">}),</span>
                    <span class="na">type</span>
        <span class="p">:</span>
            <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">dataType</span>
        <span class="p">:</span>
            <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">contentType</span>
        <span class="p">:</span>
            <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
                    <span class="na">complete</span>
        <span class="p">:</span>

            <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">buttonClicked</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#testimonialForm</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">reset</span><span class="p">();</span>
                    <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#message</span><span class="dl">'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">})</span>
            <span class="p">;</span>
        <span class="p">})</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>

</code></pre></div></div> <h2 id="testimonialtwig"> <a href="#testimonialtwig" class="anchor-heading" aria-labelledby="testimonialtwig"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> testimonial.twig </h2> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;blockquote&gt;</span>

    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"{{ testimonial.featuredImage('thumbnail').url }}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;h3</span><span class="err">{{</span> <span class="na">testimonial.post_title</span> <span class="err">}}&lt;/</span><span class="na">p</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>{{ testimonial.post_content|wpautop }}<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;footer&gt;</span>—{{ testimonial.name }}, <span class="nt">&lt;cite&gt;</span>{{ locations[testimonial.location]
        }}<span class="nt">&lt;/cite&gt;&lt;/footer&gt;</span>
<span class="nt">&lt;/blockquote&gt;</span>

</code></pre></div></div> <h2 id="testimonialstwig"> <a href="#testimonialstwig" class="anchor-heading" aria-labelledby="testimonialstwig"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> testimonials.twig </h2> <p>We love twig - code reuse :)</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
{% for testimonial in testimonials %}
{% include 'testimonials/testimonial.twig' %}
{% endfor %}

</code></pre></div></div> </div> </div> </div> </body> </html>
